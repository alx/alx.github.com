<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
  "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<title>Git Book - Branches et Merges Avancés</title>
	<meta http-equiv="content-language" content="en">
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="icon" href="favicon.png" type="image/png">
	<link rel="stylesheet" href="assets/blueprint/screen.css" type="text/css" media="screen, projection">
  <link rel="stylesheet" href="assets/blueprint/print.css" type="text/css" media="print">
  <!--[if IE]><link rel="stylesheet" href="assets/blueprint/ie.css" type="text/css" media="screen, projection"><![endif]-->
	<link rel="stylesheet" href="assets/stylesheets/mac_classic.css" type="text/css" media="screen, projection">
	<link rel="stylesheet" href="assets/stylesheets/style.css" type="text/css" media="screen, projection">
</head>

<body>
<div class="container chapter showgrids">

  <div class="span-21 header">
    <div class="nav"><a href="5_modifier_votre_historique.html">Prev</a>  <a href="5_trouver_les_problèmes_-_git_bisect.html">Next</a></div>
    <div class="title"><a href='index.html'>Git Community Book</a></div>
  </div>
  
  <div class="span-21">
    <br/>
  </div>
  
  <div class="span-21">
    <h2>Branches et Merges Avancés </h2>

<h3>Trouver de l'aide pour résoudre les conflits durant un merge </h3>

<p>Tous les changements que git peut merger automatiquement sont déjà ajoutés
à l'index, donc <a href="http://www.kernel.org/pub/software/scm/git/docs/git-diff.html">git diff</a> ne vous montre que les conflits.
Il a une syntaxe peu commune:</p>

<pre><code>$ git diff
diff --cc file.txt
index 802992c,2b60207..0000000
--- a/file.txt
+++ b/file.txt
@@@ -1,1 -1,1 +1,5 @@@
++&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD:file.txt
 +Hello world
++=======
+ Goodbye
++&gt;&gt;&gt;&gt;&gt;&gt;&gt; 77976da35a11db4580b80ae27e8d65caf5208086:file.txt
</code></pre>

<p>Souvenez-vous que le commit qui sera effectué après que nous ayons
résolu ce conflit aura 2 parents: l'un sera le sommet de la branche courante
(HEAD) et l'autre sera le sommet de la branche qui s'occupe du merge,
stockée temporairement dans MERGE_HEAD.</p>

<p>Durant le merge, l'index garde 3 versions de chaque fichiers. Une de ces 3
"étape de fichier" représente une version différente du fichier:</p>

<pre><code>$ git show :1:fichier.txt   # Le fichier dans l'ancêtre commun des 2 branches
$ git show :2:fichier.txt   # La version présente dans HEAD.
$ git show :3:fichier.txt   # La version présente dans MERGE_HEAD.
</code></pre>

<p>Quand vous demandez à <a href="http://www.kernel.org/pub/software/scm/git/docs/git-diff.html">git diff</a> de vous montrer les conflits, il fait
une différence en 3 points entre les résultats conflictuels de merge dans le
répertoire de travail avec les version 2 et 3 pour montrer seulement
les morceaux de code qui ont du contenu de chaque côté, mélangés (en d'autres
termes, quand un morceau du résultat du merge ne vient que de la version 2,
alors ce morceau n'est pas en conflit est n'est pas affiché. Idem pour la
version 3).</p>

<p>La différence en début de chapitre vous montre les différences entre la version
de travail de fichier.txt et les versions 2 et 3. Donc au lieux de rajouter les
préfixes "+" ou "-" devant chaque ligne, on utilise maintenant 2 colonnes pour
ces préfixes: la première colonne est utilisée pour les différences entre le
premier parent et la copie du répertoire de travail, et la deuxième pour les 
différences entre le second parent et la copie du répertoire de travail.
(Voir la section "COMBINED DIFF FORMAT" dans la documentation de
<a href="http://www.kernel.org/pub/software/scm/git/docs/git-diff-files.html">git diff-files</a> pour plus de détails sur ce format.)</p>

<p>Après avoir résolu le conflit de manière évidente (mais avant de mettre à jour
l'index), le diff ressemblera à:</p>

<pre><code>$ git diff
diff --cc file.txt
index 802992c,2b60207..0000000
--- a/file.txt
+++ b/file.txt
@@@ -1,1 -1,1 +1,1 @@@
- Hello world
-Goodbye
++Goodbye world
</code></pre>

<p>Cela montre que notre version résolue a effacé "Hello world" du premier
parent, et effacé "Goodbye" du second parent, puis ajouté "Goodbye world",
qui était avant absent des 2.</p>

<p>Quelques options spéciales de diff permettent de faire la différence entre
le répertoire de travail et les différentes étapes:</p>

<pre><code>$ git diff -1 file.txt          # différence avec l'étape 1
$ git diff --base file.txt      # même chose que ci-dessus
$ git diff -2 file.txt          # différence avec l'étape 2
$ git diff --ours file.txt      # même chose que ci-dessus
$ git diff -3 file.txt          # différence avec l'étape 3
$ git diff --theirs file.txt    # même chose que ci-dessus
</code></pre>

<p>Les commandes <a href="http://www.kernel.org/pub/software/scm/git/docs/git-log.html">git log</a> and <a href="http://www.kernel.org/pub/software/scm/git/docs/gitk.html">gitk</a> fournissent aussi de
l'aide particulière pour les merges:</p>

<pre><code>$ git log --merge
$ gitk --merge
</code></pre>

<p>Cela vous montrera tous les commits qui existent seulement des HEAD ou dans
MERGE_HEAD, et qui concernant les fichiers non-mergés.</p>

<p>Vous pouvez aussi utiliser <a href="http://www.kernel.org/pub/software/scm/git/docs/git-mergetool.html">git mergetool</a>, qui vous permet de
merger des fichiers non-mergés en utilisant des outils externes comme
emacs ou kdiff3.</p>

<p>Chaque fois que vous résolvez les conflits d'un fichier et que vous mettez
à jour l'index:</p>

<pre><code>$ git add fichier.txt
</code></pre>

<p>les différentes étapes de se fichiers "s'effondreront", après quoi
git-diff ne montrera plus (par défaut) de différence pour ce fichier.</p>

<h3>Merge Multiples </h3>

<p>Vous pouvez combiner plusieurs branches en même temps en les listant simplement
dans la même commande <a href="http://www.kernel.org/pub/software/scm/git/docs/git-merge.html">git merge</a>. Par exemple:</p>

<pre><code>$ git merge scott/master rick/master tom/master
</code></pre>

<p>est l'équivalent de:</p>

<pre><code>$ git merge scott/master
$ git merge rick/master
$ git merge tom/master
</code></pre>

<h3>Subtree </h3>

<p>Il y a des moments où vous voulez inclure le contenu d'un projet développé
indépendamment dans votre projet. Vous pouvez juste récupérer le code de
cet autre projet tant que les chemins ne rentrent pas en conflit.</p>

<p>Les problèmes surviennent quand il y a des fichiers en conflit.
Les candidats potentiels sont les Makefiles et les autres noms de fichiers
standardisés. Vous pouvez merger ces fichiers, mais ce n'est pas forcément
ce que vous voulez faire. Une meilleure solution pour ce problème peut être de
merger le projet dans un sous-répertoire. Mais la stratégie de merge ne
supporte la récursivité, donc la simple récupération des fichiers ne
fonctionnera pas.</p>

<p>Vous voudrez alors utiliser la stratégie de merge subtree, qui vous aidera
dans cette situation.</p>

<p>Dans cet exemple, disons que vous avez un dépôt dans /path/to/B (si vous voulez
ça peut aussi être une adresse URL). Vous voulez merger la branche "master" de
ce dépôt dans le sous-répertoire dir-B de la branche actuelle.</p>

<p>Voici la séquence de commande que vous utiliserez:</p>

<pre><code>$ git remote add -f Bproject /path/to/B (1)
$ git merge -s ours --no-commit Bproject/master (2)
$ git read-tree --prefix=dir-B/ -u Bproject/master (3)
$ git commit -m "Merge B project as our subdirectory" (4)
$ git pull -s subtree Bproject master (5)
</code></pre>

<p>Utiliser le merge subtree vous permet d'apporter moins de complications
administratives aux les utilisateurs de votre dépôt. Elle est aussi
compatible avec des version plus anciennes de git (jusqu'à Git v1.5.2)
et vous aurez le code juste après le clonage.</p>

<p>Cependant, si vous utilisez des sous-modules, vous pouvez alors choisir
de ne pas transférer les objets de ces sous-modules.  Cela peut poser
un problème lors de l'utilisation des merge subtree.</p>

<p>Il est aussi plus facile d'effectuer des changement dans votre autre projet
si vous utiliser les sous-modules.</p>

<p>(from <a href="http://www.kernel.org/pub/software/scm/git/docs/howto/using-merge-subtree.html">Using Subtree Merge</a>)</p>


  </div>
  
  <div class="span-21">
    <hr/>
    <div class="center"><a href="5_modifier_votre_historique.html">Prev</a>  <a href="5_trouver_les_problèmes_-_git_bisect.html">Next</a></div>
    <hr/>
  </div>
  
  <div class="span-17 footer">
  	<div class="menu">
  		This book is maintained by Scott Chacon, and hosting is donated by GitHub.
  		<br>
  		Please email me at <a href="mailto:schacon@gmail.com">schacon@gmail.com</a>
  		with patches, suggestions and comments.
	  </div>
  </div>
  <div class="span-4 last center">
    <a href="http://github.com"><img src="assets/images/github.png" alt="github logo"></a>
  </div>
  
</div>

<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-82337-12");
pageTracker._initData();
pageTracker._trackPageview();
</script>
<script src="http://static.getclicky.com/40584.js" type="text/javascript"></script>
<noscript><p><img alt="Clicky" src="http://in.getclicky.com/40584-db6.gif" /></p></noscript>

</body>
</html>
