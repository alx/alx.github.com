<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
  "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<title>Git Book - Git Hooks</title>
	<meta http-equiv="content-language" content="en">
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<link rel="icon" href="favicon.png" type="image/png">
	<link rel="stylesheet" href="assets/blueprint/screen.css" type="text/css" media="screen, projection">
  <link rel="stylesheet" href="assets/blueprint/print.css" type="text/css" media="print">
  <!--[if IE]><link rel="stylesheet" href="assets/blueprint/ie.css" type="text/css" media="screen, projection"><![endif]-->
	<link rel="stylesheet" href="assets/stylesheets/mac_classic.css" type="text/css" media="screen, projection">
	<link rel="stylesheet" href="assets/stylesheets/style.css" type="text/css" media="screen, projection">
</head>

<body>
<div class="container chapter showgrids">

  <div class="span-21 header">
    <div class="nav"><a href="5_personnaliser_git.html">Prev</a>  <a href="5_retrouver_des_objets_corrompus.html">Next</a></div>
    <div class="title"><a href='index.html'>Git Community Book</a></div>
  </div>
  
  <div class="span-21">
    <br/>
  </div>
  
  <div class="span-21">
    <h2>Git Hooks </h2>

<p><a href="http://www.kernel.org/pub/software/scm/git/docs/githooks.html">Git Hooks</a></p>

<h3>Hooks Côté Serveur </h3>

<h4>Reception de Post </h4>

<pre><code>GIT_DIR/hooks/post-receive
</code></pre>

<p>Si vous écrivez ceci en Ruby, vous pourrez obtenir les arguments de cette
manière:</p>

<pre class="mac_classic">
rev_old, rev_new, ref <span class="Keyword">=</span> <span class="Variable">STDIN</span>.<span class="FunctionName">read</span>.<span class="FunctionName">split</span>(<span class="String"><span class="String">&quot;</span> <span class="String">&quot;</span></span>)
</pre>

<p>Ou en script bash, quelque chose comme ça peut fonctionner:</p>

<pre><code>#!/bin/sh
# &lt;oldrev&gt; &lt;newrev&gt; &lt;refname&gt;
# update a blame tree
while read oldrev newrev ref
do
    echo "STARTING [$oldrev $newrev $ref]"
    for path in `git diff-tree -r $oldrev..$newrev | awk '{print $6}'`
    do
      echo "git update-ref refs/blametree/$ref/$path $newrev"
      `git update-ref refs/blametree/$ref/$path $newrev`
    done
done
</code></pre>

<h3>Hooks Côté Client </h3>

<h4>Pre Commit </h4>

<p>Lancer vos tests automatiquement avant de committer</p>

<pre><code>GIT_DIR/hooks/pre-commit
</code></pre>

<p>Voici un exemple d'un script Ruby qui exécute des tests RSpec avant de vous
permettre de faire un commit.</p>

<pre class="mac_classic">
html_path <span class="Keyword">=</span> <span class="String"><span class="String">&quot;</span>spec_results.html<span class="String">&quot;</span></span>  
<span class="String"><span class="String">`</span>spec -f h:<span class="StringInterpolation"><span class="StringInterpolation">#{</span>html_path<span class="StringInterpolation">}</span></span> -f p spec<span class="String">`</span></span> <span class="Comment"><span class="Comment">#</span> lancer rspec, affichier la prograssion, sauvegarde le resultat html dans html_path</span>

<span class="Comment"><span class="Comment">#</span> affiche combien d'erreurs ont été trouvées</span>
html <span class="Keyword">=</span> <span class="FunctionName">open</span>(html_path).<span class="FunctionName">read</span>  
examples <span class="Keyword">=</span> html.<span class="FunctionName">match</span>(<span class="String"><span class="String">/</span></span><span class="String"><span class="String"><span class="String">(</span><span class="StringInterpolation">\d</span>+<span class="String">)</span></span> examples</span><span class="String"><span class="String">/</span></span>)[<span class="Number">0</span>].<span class="FunctionName">to_i</span> <span class="Keyword">rescue</span> <span class="Number">0</span>  
failures <span class="Keyword">=</span> html.<span class="FunctionName">match</span>(<span class="String"><span class="String">/</span></span><span class="String"><span class="String"><span class="String">(</span><span class="StringInterpolation">\d</span>+<span class="String">)</span></span> failures</span><span class="String"><span class="String">/</span></span>)[<span class="Number">0</span>].<span class="FunctionName">to_i</span> <span class="Keyword">rescue</span> <span class="Number">0</span>  
pending <span class="Keyword">=</span> html.<span class="FunctionName">match</span>(<span class="String"><span class="String">/</span></span><span class="String"><span class="String"><span class="String">(</span><span class="StringInterpolation">\d</span>+<span class="String">)</span></span> pending</span><span class="String"><span class="String">/</span></span>)[<span class="Number">0</span>].<span class="FunctionName">to_i</span> <span class="Keyword">rescue</span> <span class="Number">0</span>  

<span class="Keyword">if</span> failures.<span class="FunctionName">zero?</span>  
  puts <span class="String"><span class="String">&quot;</span>0 failures! <span class="StringInterpolation"><span class="StringInterpolation">#{</span>examples<span class="StringInterpolation">}</span></span> run, <span class="StringInterpolation"><span class="StringInterpolation">#{</span>pending<span class="StringInterpolation">}</span></span> pending<span class="String">&quot;</span></span>  
<span class="Keyword">else</span>  
  puts <span class="String"><span class="String">&quot;</span><span class="StringInterpolation">\a</span>DID NOT COMMIT YOUR FILES!<span class="String">&quot;</span></span>  
  puts <span class="String"><span class="String">&quot;</span>View spec results at <span class="StringInterpolation"><span class="StringInterpolation">#{</span><span class="LibraryObject">File</span><span class="StringInterpolation"><span class="StringInterpolation">.</span><span class="FunctionName">expand_path</span></span><span class="StringInterpolation">(</span>html_path<span class="StringInterpolation">)</span><span class="StringInterpolation">}</span></span><span class="String">&quot;</span></span>  
  puts  
  puts <span class="String"><span class="String">&quot;</span><span class="StringInterpolation"><span class="StringInterpolation">#{</span>failures<span class="StringInterpolation">}</span></span> failures! <span class="StringInterpolation"><span class="StringInterpolation">#{</span>examples<span class="StringInterpolation">}</span></span> run, <span class="StringInterpolation"><span class="StringInterpolation">#{</span>pending<span class="StringInterpolation">}</span></span> pending<span class="String">&quot;</span></span>  
  exit <span class="Number">1</span>  
<span class="Keyword">end</span>
</pre>

<ul>
<li>http://probablycorey.wordpress.com/2008/03/07/git-hooks-make-me-giddy/</li>
</ul>



  </div>
  
  <div class="span-21">
    <hr/>
    <div class="center"><a href="5_personnaliser_git.html">Prev</a>  <a href="5_retrouver_des_objets_corrompus.html">Next</a></div>
    <hr/>
  </div>
  
  <div class="span-17 footer">
  	<div class="menu">
  		This book is maintained by Scott Chacon, and hosting is donated by GitHub.
  		<br>
  		Please email me at <a href="mailto:schacon@gmail.com">schacon@gmail.com</a>
  		with patches, suggestions and comments.
	  </div>
  </div>
  <div class="span-4 last center">
    <a href="http://github.com"><img src="assets/images/github.png" alt="github logo"></a>
  </div>
  
</div>

<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-82337-12");
pageTracker._initData();
pageTracker._trackPageview();
</script>
<script src="http://static.getclicky.com/40584.js" type="text/javascript"></script>
<noscript><p><img alt="Clicky" src="http://in.getclicky.com/40584-db6.gif" /></p></noscript>

</body>
</html>
